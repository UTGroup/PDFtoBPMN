#!/bin/bash
# Setup script for BPMN Process Automation project
# –°–æ–∑–¥–∞–µ—Ç –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –ø–∞–ø–∫–∏ input/ –∏ output/

set -e

echo "üîß –ù–ê–°–¢–†–û–ô–ö–ê –ü–†–û–ï–ö–¢–ê: BPMN Process Automation"
echo ""

# –û–ø—Ä–µ–¥–µ–ª—è–µ–º –∫–æ—Ä–µ–Ω—å –ø—Ä–æ–µ–∫—Ç–∞
PROJECT_ROOT="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"
cd "$PROJECT_ROOT"

echo "üìÅ –ö–æ—Ä–µ–Ω—å –ø—Ä–æ–µ–∫—Ç–∞: $PROJECT_ROOT"
echo ""

# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –ø–∞–ø–æ–∫
if [ -L "input" ] || [ -d "input" ]; then
    echo "‚ö†Ô∏è  input/ —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç"
    read -p "   –ü–µ—Ä–µ–∑–∞–ø–∏—Å–∞—Ç—å? (y/n) " -n 1 -r
    echo
    if [[ $REPLY =~ ^[Yy]$ ]]; then
        rm -rf input
    else
        echo "   –ü—Ä–æ–ø—É—Å–∫–∞–µ–º input/"
    fi
fi

if [ -L "output" ] || [ -d "output" ]; then
    echo "‚ö†Ô∏è  output/ —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç"
    read -p "   –ü–µ—Ä–µ–∑–∞–ø–∏—Å–∞—Ç—å? (y/n) " -n 1 -r
    echo
    if [[ $REPLY =~ ^[Yy]$ ]]; then
        rm -rf output
    else
        echo "   –ü—Ä–æ–ø—É—Å–∫–∞–µ–º output/"
    fi
fi

echo ""
echo "‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê"
echo "–í–´–ë–ï–†–ò–¢–ï –í–ê–†–ò–ê–ù–¢ –ù–ê–°–¢–†–û–ô–ö–ò:"
echo "‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê"
echo ""
echo "1Ô∏è‚É£  –õ–û–ö–ê–õ–¨–ù–´–ï –ü–ê–ü–ö–ò (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è)"
echo "   ‚Ä¢ input/ –∏ output/ –±—É–¥—É—Ç —Å–æ–∑–¥–∞–Ω—ã –ª–æ–∫–∞–ª—å–Ω–æ"
echo "   ‚Ä¢ –ü—Ä–æ—Å—Ç–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞, —Ä–∞–±–æ—Ç–∞–µ—Ç —Å—Ä–∞–∑—É"
echo ""
echo "2Ô∏è‚É£  NEXTCLOUD / –û–ë–õ–ê–ß–ù–ê–Ø –°–ò–ù–•–†–û–ù–ò–ó–ê–¶–ò–Ø"
echo "   ‚Ä¢ input/ –∏ output/ - —Å–∏–º–≤–æ–ª–∏—á–µ—Å–∫–∏–µ —Å—Å—ã–ª–∫–∏ –Ω–∞ –æ–±–ª–∞—á–Ω–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ"
echo "   ‚Ä¢ –¢—Ä–µ–±—É–µ—Ç –ø—É—Ç—å –∫ Nextcloud/–æ–±–ª–∞–∫—É"
echo "   ‚Ä¢ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –∏ —Ä–µ–∑–µ—Ä–≤–Ω–æ–µ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ"
echo ""
read -p "–í–∞—à –≤—ã–±–æ—Ä (1 –∏–ª–∏ 2): " -n 1 -r
echo
echo ""

if [[ $REPLY =~ ^[1]$ ]]; then
    # –í–∞—Ä–∏–∞–Ω—Ç 1: –õ–æ–∫–∞–ª—å–Ω—ã–µ –ø–∞–ø–∫–∏
    echo "üì¶ –°–æ–∑–¥–∞–Ω–∏–µ –ª–æ–∫–∞–ª—å–Ω—ã—Ö –ø–∞–ø–æ–∫..."
    
    if [ ! -e "input" ]; then
        mkdir -p input
        echo "‚úÖ –°–æ–∑–¥–∞–Ω–∞: input/"
    fi
    
    if [ ! -e "output" ]; then
        mkdir -p output
        echo "‚úÖ –°–æ–∑–¥–∞–Ω–∞: output/"
    fi
    
    echo ""
    echo "‚úÖ –ì–û–¢–û–í–û: –õ–æ–∫–∞–ª—å–Ω—ã–µ –ø–∞–ø–∫–∏ —Å–æ–∑–¥–∞–Ω—ã"
    echo ""
    echo "üìù –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏:"
    echo "   1. –ü–æ–º–µ—Å—Ç–∏—Ç–µ PDF –¥–æ–∫—É–º–µ–Ω—Ç—ã –≤ input/"
    echo "   2. –ó–∞–ø—É—Å—Ç–∏—Ç–µ –æ–±—Ä–∞–±–æ—Ç–∫—É: python3 run_ocr.py input/document.pdf"
    echo "   3. –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø–æ—è–≤—è—Ç—Å—è –≤ output/"

elif [[ $REPLY =~ ^[2]$ ]]; then
    # –í–∞—Ä–∏–∞–Ω—Ç 2: Nextcloud/–æ–±–ª–∞–∫–æ
    echo "‚òÅÔ∏è  –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –æ–±–ª–∞—á–Ω–æ–π —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏..."
    echo ""
    
    # –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø—É—Ç–∏ –∫ –æ–±–ª–∞–∫—É
    if [ -d "/mnt/c/Users" ]; then
        # WSL2 –æ–∫—Ä—É–∂–µ–Ω–∏–µ
        DEFAULT_CLOUD="/mnt/c/Users/$USER/Nextcloud/PDFtoBPMN"
        echo "üîç –û–±–Ω–∞—Ä—É–∂–µ–Ω–æ WSL2 –æ–∫—Ä—É–∂–µ–Ω–∏–µ"
    else
        # Linux –æ–∫—Ä—É–∂–µ–Ω–∏–µ
        DEFAULT_CLOUD="$HOME/Nextcloud/PDFtoBPMN"
        echo "üîç –û–±–Ω–∞—Ä—É–∂–µ–Ω–æ Linux –æ–∫—Ä—É–∂–µ–Ω–∏–µ"
    fi
    
    echo ""
    echo "üìÇ –ü—É—Ç—å –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é: $DEFAULT_CLOUD"
    read -p "   –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å? (y/n) " -n 1 -r
    echo
    
    if [[ $REPLY =~ ^[Nn]$ ]]; then
        echo ""
        read -p "   –í–≤–µ–¥–∏—Ç–µ –ø–æ–ª–Ω—ã–π –ø—É—Ç—å –∫ –æ–±–ª–∞—á–Ω–æ–º—É —Ö—Ä–∞–Ω–∏–ª–∏—â—É: " CLOUD_PATH
    else
        CLOUD_PATH="$DEFAULT_CLOUD"
    fi
    
    # –°–æ–∑–¥–∞–Ω–∏–µ –ø–∞–ø–æ–∫ –≤ –æ–±–ª–∞–∫–µ (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ)
    if [ ! -d "$CLOUD_PATH" ]; then
        echo ""
        read -p "‚ö†Ô∏è  –ü–∞–ø–∫–∞ $CLOUD_PATH –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç. –°–æ–∑–¥–∞—Ç—å? (y/n) " -n 1 -r
        echo
        if [[ $REPLY =~ ^[Yy]$ ]]; then
            mkdir -p "$CLOUD_PATH/input"
            mkdir -p "$CLOUD_PATH/output"
            echo "‚úÖ –°–æ–∑–¥–∞–Ω—ã –ø–∞–ø–∫–∏ –≤ –æ–±–ª–∞–∫–µ"
        else
            echo "‚ùå –û—Ç–º–µ–Ω–∞ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏"
            exit 1
        fi
    fi
    
    # –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏—è input/output –≤ –æ–±–ª–∞–∫–µ
    if [ ! -d "$CLOUD_PATH/input" ]; then
        mkdir -p "$CLOUD_PATH/input"
        echo "‚úÖ –°–æ–∑–¥–∞–Ω–∞: $CLOUD_PATH/input"
    fi
    
    if [ ! -d "$CLOUD_PATH/output" ]; then
        mkdir -p "$CLOUD_PATH/output"
        echo "‚úÖ –°–æ–∑–¥–∞–Ω–∞: $CLOUD_PATH/output"
    fi
    
    # –°–æ–∑–¥–∞–Ω–∏–µ —Å–∏–º–≤–æ–ª–∏—á–µ—Å–∫–∏—Ö —Å—Å—ã–ª–æ–∫
    if [ ! -e "input" ]; then
        ln -s "$CLOUD_PATH/input" input
        echo "üîó –°–æ–∑–¥–∞–Ω–∞ —Å—Å—ã–ª–∫–∞: input ‚Üí $CLOUD_PATH/input"
    fi
    
    if [ ! -e "output" ]; then
        ln -s "$CLOUD_PATH/output" output
        echo "üîó –°–æ–∑–¥–∞–Ω–∞ —Å—Å—ã–ª–∫–∞: output ‚Üí $CLOUD_PATH/output"
    fi
    
    echo ""
    echo "‚úÖ –ì–û–¢–û–í–û: –û–±–ª–∞—á–Ω–∞—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∞"
    echo ""
    echo "üìù –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏:"
    echo "   1. PDF –¥–æ–∫—É–º–µ–Ω—Ç—ã —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É—é—Ç—Å—è —á–µ—Ä–µ–∑: $CLOUD_PATH/input"
    echo "   2. –ó–∞–ø—É—Å—Ç–∏—Ç–µ –æ–±—Ä–∞–±–æ—Ç–∫—É: python3 run_ocr.py input/document.pdf"
    echo "   3. –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É—é—Ç—Å—è —á–µ—Ä–µ–∑: $CLOUD_PATH/output"

else
    echo "‚ùå –ù–µ–≤–µ—Ä–Ω—ã–π –≤—ã–±–æ—Ä. –û—Ç–º–µ–Ω–∞."
    exit 1
fi

echo ""
echo "‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê"
echo "üéâ –ù–ê–°–¢–†–û–ô–ö–ê –ó–ê–í–ï–†–®–ï–ù–ê"
echo "‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê"
echo ""
echo "üìä –¢–µ–∫—É—â–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞:"
ls -lah input output 2>/dev/null || echo "–û—à–∏–±–∫–∞ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è"
echo ""
echo "üöÄ –î–ª—è –Ω–∞—á–∞–ª–∞ —Ä–∞–±–æ—Ç—ã —Å–º. README.md"

